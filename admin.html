<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ø£Ø¯Ù…Ù† - Ø§Ù„Ø·ÙŠØ¨Ø§Øª</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
<style>
.admin-area{max-width:1200px;margin:40px auto}
.admin-card{border-radius:12px}
.stat-box{border-radius:12px;padding:20px;text-align:center;}
.stat-num{font-size:26px;font-weight:bold;color:#c00}
#statProducts { background-color: #ffe0e0; }
#statOrders { background-color: #e0ffe0; }
#statMoney  { background-color: #e0e0ff; }
#statFeedback { background-color: #fff0b3; }
</style>
</head>
<body>

<header class="bg-danger py-2">
  <div class="container d-flex justify-content-between align-items-center">
    <a href="index.html" class="text-white fw-bold fs-4">ğŸ¯ Ø§Ù„Ø·ÙŠØ¨Ø§Øª</a>
    <div class="text-white">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</div>
  </div>
</header>

<div class="admin-area container">

<!-- Login -->
<div id="loginBox" class="card p-4 admin-card mb-4">
<h5>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h5>
<div class="row g-2">
<div class="col-md-6"><input id="adminPass" class="form-control" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"></div>
<div class="col-md-6 d-grid"><button id="loginBtn" class="btn btn-danger">Ø¯Ø®ÙˆÙ„</button></div>
</div>
<small class="text-muted mt-2 d-block">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: admin123</small>
</div>

<div id="adminArea" style="display:none">

<!-- Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬ -->
<div class="row mb-4">
<div class="col-lg-8">
<div class="card p-3 admin-card">
<h5>Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬</h5>
<form id="prodForm" class="row g-2">
<div class="col-12"><input id="prodName" class="form-control" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬" required></div>
<div class="col-6"><input id="prodPrice" type="number" class="form-control" placeholder="Ø§Ù„Ø³Ø¹Ø±" required></div>
<div class="col-6"><input id="prodImg" type="file" class="form-control"></div>
<div class="col-12"><textarea id="prodDesc" class="form-control" placeholder="ÙˆØµÙ Ù‚ØµÙŠØ±"></textarea></div>
<div class="col-12 d-grid"><button class="btn btn-warning" type="submit">Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬</button></div>
</form>
</div>
</div>

<!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
<div class="col-lg-4">
<div class="card p-3 admin-card">
<h5 class="text-center mb-3">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</h5>
<div class="stat-box mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª<div id="statProducts" class="stat-num">0</div></div>
<div class="stat-box mb-2">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª<div id="statOrders" class="stat-num">0</div></div>
<div class="stat-box mb-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª<div id="statMoney" class="stat-num">0 Ø¬.Ù…</div></div>
<div class="stat-box">Ø¹Ø¯Ø¯ Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ<div id="statFeedback" class="stat-num">0</div></div>
</div>
</div>
</div>

<!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
<div class="card p-3 admin-card mb-4">
<h5>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h5>
<div id="adminProducts" class="row g-3"></div>
</div>

<!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø© -->
<div class="card p-3 admin-card mb-4">
<h5>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h5>
<div class="table-responsive mt-2">
<table class="table table-bordered">
<thead class="table-danger">
<tr><th>Ø±Ù‚Ù…</th><th>Ø¹Ù…ÙŠÙ„</th><th>Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø¹Ø±Ø¶</th><th>Ø­Ø°Ù</th></tr>
</thead>
<tbody id="ordersBody"></tbody>
</table>
</div>
</div>

<!-- Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª -->
<div class="card p-3 admin-card mb-4">
<h5>Ø§Ù„Ø´ÙƒØ§ÙˆÙŠ ÙˆØ§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª</h5>
<div id="feedbackList"></div>
</div>

</div>
</div>

<!-- Ù…ÙƒØªØ¨Ø© jsPDF -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>


<script>
/* ğŸŸ¥ Login */
const loginBox=document.getElementById('loginBox');
const adminArea=document.getElementById('adminArea');
const loginBtn=document.getElementById('loginBtn');
const adminPass=document.getElementById('adminPass');

loginBtn.addEventListener('click', loginAdmin);
adminPass.addEventListener('keypress', e=>{ if(e.key==='Enter') loginAdmin(); });

function loginAdmin(){
if(adminPass.value==='admin123'){
loginBox.style.display='none';
adminArea.style.display='block';
loadAdmin();
}else alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©');
}

/* ğŸŸ¥ LocalStorage Shortcuts */
const fetchProducts=()=>JSON.parse(localStorage.getItem('et_products')||'[]');
const saveProducts=arr=>localStorage.setItem('et_products',JSON.stringify(arr));
const fetchOrders=()=>JSON.parse(localStorage.getItem('et_orders')||'[]');
const saveOrders=arr=>localStorage.setItem('et_orders',JSON.stringify(arr));
const fetchFeedback=()=>JSON.parse(localStorage.getItem('et_feedback')||'[]');
const saveFeedback=arr=>localStorage.setItem('et_feedback',JSON.stringify(arr));

/* ğŸŸ¥ Dashboard Loader */
function loadAdmin(){
renderAdminProducts();
renderAdminOrders();
renderFeedback();
updateStats();
}

/* ğŸŸ© Stats Update */
function updateStats(){
const p=fetchProducts();
const o=fetchOrders();
const f=fetchFeedback();
let money=0; o.forEach(x=>money+=x.total||0);
document.getElementById('statProducts').innerText=p.length;
document.getElementById('statOrders').innerText=o.length;
document.getElementById('statMoney').innerText=money+' Ø¬.Ù…';
document.getElementById('statFeedback').innerText=f.length;
}

/* ğŸŸ¨ Product CRUD */
let editIndex=null;
document.getElementById('prodForm').addEventListener('submit', e=>{
e.preventDefault();
const name=document.getElementById('prodName').value.trim();
const price=parseFloat(document.getElementById('prodPrice').value)||0;
const desc=document.getElementById('prodDesc').value.trim();
let img='assets/placeholder.jpg';
const fileInput=document.getElementById('prodImg');
if(fileInput.files && fileInput.files[0]){
const reader=new FileReader();
reader.onload=function(e){ img=e.target.result; saveProductAndRender(name,price,img,desc); }
reader.readAsDataURL(fileInput.files[0]);
}else saveProductAndRender(name,price,img,desc);
});

function saveProductAndRender(name,price,img,desc){
const arr=fetchProducts();
if(editIndex!==null){ arr[editIndex]={...arr[editIndex],name,price,img,desc}; editIndex=null; } 
else arr.unshift({id:Date.now(),name,price,img,desc});
saveProducts(arr); document.getElementById('prodForm').reset(); renderAdminProducts(); updateStats();
}

function renderAdminProducts(){
const arr=fetchProducts(); const box=document.getElementById('adminProducts'); box.innerHTML='';
arr.forEach((p,i)=>{
box.innerHTML+=`
<div class="col-12">
<div class="d-flex justify-content-between border p-2 rounded align-items-center">
<div>
<strong>${p.name}</strong><br><span class="text-danger">${p.price} Ø¬.Ù…</span><br>${p.desc}
</div>
<div>
<button class="btn btn-sm btn-primary" onclick="editProd(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
<button class="btn btn-sm btn-danger" onclick="delProd(${i})">Ø­Ø°Ù</button>
</div>
</div></div>`; });
}

function editProd(i){
const arr=fetchProducts(); const p=arr[i];
document.getElementById('prodName').value=p.name;
document.getElementById('prodPrice').value=p.price;
document.getElementById('prodDesc').value=p.desc;
editIndex=i;
}

function delProd(i){
if(!confirm('Ø­Ø°ÙØŸ'))return;
const arr=fetchProducts(); arr.splice(i,1);
saveProducts(arr); renderAdminProducts(); updateStats();
}

/* ğŸŸ¦ Orders */
function renderAdminOrders(){
const o=fetchOrders();
const body=document.getElementById('ordersBody'); body.innerHTML='';
o.forEach((or,i)=>{
body.innerHTML+=`<tr>
<td>${or.id||i+1}</td>
<td>${or.name}</td>
<td>${or.phone}</td>
<td>${or.address}</td>
<td>${or.total||0} Ø¬.Ù…</td>
<td><button class="btn btn-sm btn-primary" onclick="viewOrder(${i})">ğŸ‘</button></td>
<td><button class="btn btn-sm btn-danger" onclick="deleteOrder(${i})">ğŸ—‘</button></td>
</tr>`;
});
updateStats();
}

function viewOrder(i){
  const o = fetchOrders()[i];
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF({orientation:'portrait', unit:'pt', format:'a4'});
  let y = 40;
  
  doc.setFontSize(18);
  doc.text(`ÙØ§ØªÙˆØ±Ø© Ø·Ù„Ø¨ Ø±Ù‚Ù… ${o.id||i+1}`, 40, y);
  y += 30;

  doc.setFontSize(14);
  doc.text(`Ø§Ù„Ø¹Ù…ÙŠÙ„: ${o.name}`, 40, y); y+=20;
  doc.text(`Ø§Ù„Ù‡Ø§ØªÙ: ${o.phone}`, 40, y); y+=20;

  let addr = o.address || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¹Ù†ÙˆØ§Ù†";
  if(addr.startsWith("https://www.google.com/maps")) addr = "Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¹Ù…ÙŠÙ„";
  doc.text(`Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: ${addr}`, 40, y); y+=30;

  doc.text(`Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:`, 40, y); y+=20;
  (o.items||[]).forEach(item=>{
    doc.text(`- ${item.name} | Ø§Ù„ÙƒÙ…ÙŠØ©: ${item.qty} | Ø§Ù„Ø³Ø¹Ø±: ${item.price} Ø¬.Ù…`, 40, y);
    y += 20;
  });

  y += 10;
  doc.text(`Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${o.total||0} Ø¬.Ù…`, 40, y);

  // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù„Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ù…Ø¹ Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© ÙˆØ§Ù„Ø­ÙØ¸
  const pdfData = doc.output('bloburl');
  window.open(pdfData, '_blank');
}


function deleteOrder(i){
if(!confirm('Ø­Ø°ÙØŸ'))return;
const arr=fetchOrders(); arr.splice(i,1);
saveOrders(arr); renderAdminOrders(); updateStats();
}

/* ğŸŸ¨ Feedback */
function renderFeedback(){
const arr=fetchFeedback(); const box=document.getElementById('feedbackList'); box.innerHTML='';
if(arr.length===0){ box.innerHTML='<p class="text-muted">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</p>'; return; }
arr.forEach((f,i)=>{
box.innerHTML+=`<div class="border p-2 mb-2 rounded">
<strong>${f.name} (${f.type})</strong> â€” <small>${f.date}</small><br>${f.msg}
<button class="btn btn-sm btn-danger float-end" onclick="deleteFeedback(${i})">Ø­Ø°Ù</button>
</div>`; });
}

function deleteFeedback(i){
const arr=fetchFeedback(); arr.splice(i,1);
saveFeedback(arr); renderFeedback(); updateStats();
}

window.addEventListener('load',()=>{});


</script>

</body>
</html>
